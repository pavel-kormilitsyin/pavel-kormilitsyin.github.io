(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"0239":function(e,t,s){},"0350":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",[e.userInfo.test?s("div",{staticClass:"fixed-top-right",staticStyle:{"z-index":"10000"},style:{top:e.$q.screen.lt.sm?"20px":"15px",right:e.$q.screen.lt.sm?"10px":"90px"}},[s("q-btn",{attrs:{round:"",icon:"img:icons/Panel_Menu_07.svg",dense:""}},[s("q-menu",{attrs:{"content-class":"card-shadow transparent normal"}},[s("q-card",{staticClass:"q-mt-xs"},[s("q-card-section",{staticClass:"row items-center"},[s("div",{staticClass:"col"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Просмотрено"},on:{click:function(t){return e.change(!0)}}})],1),s("div",{staticClass:"col-auto"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Не просмотрено"},on:{click:function(t){return e.change(!1)}}})],1)])],1)],1)],1)],1):e._e(),e.$q.platform.is.mobile?e._e():s("lesson-desktop",{ref:"lesson"}),e.$q.platform.is.mobile?s("lesson-mobile",{ref:"lesson"}):e._e()],1)},n=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",[e.lesson?s("div",{staticClass:"row items-center head-page"},[s("div",{staticClass:"q-ml-sm title"},[e._v("Урок #"+e._s(e.lesson.number))]),s("div",{staticClass:"q-ml-sm subtitle col ellipsis"},[e._v(e._s(e.lesson?e.lesson.title:"-")+"\n        "),s("q-tooltip",{staticClass:"bg-dark text-white"},[s("span",{staticClass:"fs-16"},[e._v(e._s(e.lesson.title))])])],1),s("q-btn",{staticClass:"btn-white row items-center q-ml-lg col-auto",attrs:{"no-caps":"",flat:""},on:{click:function(t){return e.$router.go(-1)}}},[s("q-icon",{staticStyle:{transform:"rotate(180deg)"},attrs:{name:"img:icons/Arrow_Small.svg",size:"11px"}}),s("span",{staticClass:"q-ml-md"},[e._v("Назад")])],1)],1):e._e(),s("div",{staticClass:"content-page"},[e.lesson?s("div",{staticClass:"row"},[s("div",{class:{"col-12 q-pa-md":e.$q.screen.width<1024,col:e.$q.screen.width>1024}},[s("q-card",{staticClass:"card-shadow"},[s("q-card-section",{staticClass:"gradient-grey q-pa-none"},[s("video-player-ai",{ref:"vp",attrs:{lesson:e.lesson},on:{getLessonD:e.getLessonD}})],1),e.lesson.train_allowed?s("q-separator"):e._e(),e.lesson.train_allowed?s("q-card-section",[s("q-btn",{staticClass:"btn-orange",attrs:{flat:"","no-caps":"",to:"/training/"+e.lesson_id}},[s("q-icon",{attrs:{name:"img:icons/Button_Training.svg",size:"28px"}}),s("span",{staticClass:"btn-title"},[e._v("Пройти тренировку")])],1)],1):e._e()],1)],1),s("div",{class:{"col-12 q-pa-md":e.$q.screen.width<1024,"col-auto q-ml-md":e.$q.screen.width>1024},style:{"min-width":e.$q.screen.width>1024?"500px":"100%"}},[s("q-card",{staticClass:"card-shadow"},[s("q-card-section",{staticClass:"font-sspro-sr q-pa-md ",staticStyle:{"border-radius":"12px",overflow:"hidden"}},[s("div",{staticClass:"row items-center"},[s("div",{staticClass:"user-avatar"},[s("img",{attrs:{src:e.teacherContact&&e.teacherContact.avatar?e.origin+"/"+e.teacherContact.avatar:e.avatar_null,alt:""}})]),e.teacherContact?s("div",{staticClass:"user-username"},[e._v("\n            "+e._s(e.teacherContact?e.teacherContact.full_name:"---")+"\n          ")]):s("div",{staticClass:"user-username"},[e._v("\n            Чат с преподавателем\n          ")]),e.teacherContact?s("div",{staticClass:"user-status"},[s("span",{staticClass:"online"},[s("span",{staticClass:"bg"})]),s("p",{staticClass:"text"},[e._v("На связи")])]):e._e()])]),s("q-separator"),e.teacherContact?e._e():s("q-card-section",[s("div",{ref:"chat_teacher",staticClass:"q-pa-none flex flex-center",style:{"min-height":e.chatHeight-60+"px"}},[e._v("\n       Подключение отсутствует\n       ")])]),e.teacherContact?s("q-card-section",{staticClass:"q-pa-none"},[s("chat",{ref:"chat_teacher",attrs:{height:e.chatHeight,color_input:"#fff"}})],1):e._e()],1)],1)]):e._e()]),s("q-resize-observer",{on:{resize:e.resizePage}})],1)},r=[],o=(s("c740"),s("e260"),s("b0c0"),s("d3b7"),s("e6cf"),s("3ca3"),s("ddb0"),s("ded3")),l=s.n(o),c=(s("bc3a"),s("2f62")),d=s("4476"),u=s("9420"),p=s("dafb"),h=s("9d0b"),m=s("9ce6"),f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("detected-speed",{on:{"network-type":e.handleNetworkIdentified,"network-speed":e.handleNetworkSpeed}}),e.preloadVideo?s("div",{staticClass:"position-relative",staticStyle:{padding:"56.25% 0 0 0",background:"#fff"}},[s("div",{staticClass:"row items-center",staticStyle:{position:"absolute","padding-top":"26%",top:"0",left:"0",right:"0",margin:"auto",width:"150px",height:"50px"}},[s("div",{staticClass:"col"},[s("q-spinner-tail",{attrs:{color:"orange",size:"2em"}})],1),s("div",{staticClass:"col-auto"},[e._v("Загрузка видео")])])]):e._e(),0!=e.playerOptions.sources.length?s("div",[s("div",{staticClass:"vjs-custom-skin"},[s("video",{ref:"videoPlayer",staticClass:"video-js",attrs:{controls:"",preload:"auto",width:"640",height:"268","data-setup":"{}"}},e._l(e.playerOptions.sources,(function(e){return s("source",{attrs:{src:e.src,type:"video/mp4",label:e.label,selected:"true"}})})),0)])]):e._e()],1)},g=[],v=(s("4de4"),s("7db0"),s("96cf"),s("c973")),C=s.n(v),y=s("f0e2"),b=(s("3e61"),s("fda2"),s("0239"),s("b7e1"));s("deae")(y["default"]);var w={name:"VideoPlayer",components:{DetectedSpeed:b["a"]},props:{lesson:{type:Object,default:null}},data:function(){return{preloadVideo:!0,lessonCurr:null,player:null,duration:null,playerOptions:{autoplay:!0,muted:!1,responsive:!0,fluid:!0,controls:!0,language:"ru",pictureInPicture:!0,playbackRates:[1,1.25,1.5,1.75,3,5],sources:[],poster:"/static/images/author.jpg",controlBar:{remainingTimeDisplay:!1,pictureInPictureToggle:!1,progressControl:!0,qualitySelector:!0}},currentTime:0,limitTime:0,intervalRecord:5,lastTime:0,isseekedEnd:!1}},methods:l()(l()({},Object(c["b"])(["sendLessonProgress","getListLessons","getVimeoUrls"])),{},{handleNetworkIdentified:function(e){},handleNetworkSpeed:function(e){e<=1.5&&e>.01&&this.$q.notify({timeout:5e3,html:!0,message:"Низкая скорость интернет-соединения!<br>\n        Это может влиять на просмотр видео!",icon:"network_check",actions:[{label:"Понтяно",color:"white",handler:function(){}}]})},sendProgress:function(e){var t=this;return C()(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return e.id=parseInt(t.lessonCurr.id),s.next=3,t.sendLessonProgress(e).then((function(e){return e}));case 3:case"end":return s.stop()}}),s)})))()},isview:function(e){var t=this;this.sendProgress({is_lesson_viewed:e,lesson_last_time:e?parseInt(this.duration):0}).then((function(e){t.$emit("getLessonD",parseInt(t.lessonCurr.id))}))},initPlayer:function(){var e=this,t=this;this.lessonCurr=JSON.parse(JSON.stringify(this.lesson)),this.getVimeoUrls({id:this.lessonCurr.id}).then((function(s){if(0!=_.filter(s.data,(function(e){return e.hasOwnProperty("uri")})).length){var a=_.find(s.data,{quality:"sd"});void 0!=a&&e.playerOptions.sources.push({type:"video/mp4",src:a.uri,label:"SD"});var n=_.find(s.data,{quality:"hd"});void 0!=n&&e.playerOptions.sources.push({type:"video/mp4",src:n.uri,label:"HD"}),e.$nextTick((function(){e.player=Object(y["default"])(e.$refs.videoPlayer,e.playerOptions,(function(){t.preloadVideo=!1})),e.lessonCurr.viewed&&(e.lessonCurr.lesson_last_time=1),e.currentTime=e.lessonCurr.lesson_last_time,e.limitTime=e.lessonCurr.lesson_last_time,e.player.currentTime(e.currentTime),e.player.landscapeFullscreen({fullscreen:{enterOnRotate:!0,alwaysInLandscapeMode:!0,iOS:!1}}),e.player.on("loadedmetadata",(function(t){e.duration=e.player.duration()})),e.player.on("ended",(function(t){e.sendProgress({is_lesson_viewed:!0,lesson_last_time:e.duration?parseInt(e.duration):parseInt(e.currentTime)}).then((function(t){e.$emit("getLessonD",parseInt(e.lessonCurr.id))}))})),e.player.on("timeupdate",(function(t){parseInt(e.player.currentTime())%(e.intervalRecord*e.player.playbackRate())==0&&parseInt(e.player.currentTime())>e.intervalRecord*e.player.playbackRate()&&e.lastTime!=parseInt(e.player.currentTime())&&e.lastTime<e.player.currentTime()&&!e.isseekedEnd&&!e.player.paused()&&!e.lessonCurr.viewed&&(e.lastTime=parseInt(e.player.currentTime()),e.limitTime=e.player.currentTime(),e.sendProgress({lesson_last_time:parseInt(e.player.currentTime())})),e.currentTime=e.player.currentTime()})),e.player.on("seeking",(function(t){e.isseekedEnd=!0,e.limitTime<e.player.currentTime()&&parseInt(e.limitTime)!=parseInt(e.player.currentTime())&&!e.lessonCurr.viewed&&(e.currentTime=e.limitTime,e.player.currentTime(e.limitTime))})),e.player.on("seeked",(function(t){e.player.paused()||e.player.pause(),e.limitTime<e.player.currentTime()&&parseInt(e.limitTime)!=parseInt(e.player.currentTime())&&!e.lessonCurr.viewed&&(e.currentTime=e.limitTime,e.player.currentTime(e.limitTime)),setTimeout((function(){e.player.paused()&&e.player.play(),e.isseekedEnd=!1}),500)}))}))}else e.$q.notify({timeout:0,html:!0,message:"Что-то пошло не так!<br>\n        Попробуйте обновить страницу!",icon:"report_problem",actions:[{label:"Перезапустить",color:"white",handler:function(){e.initPlayer()}}]})}))}}),computed:l()({},Object(c["c"])(["currCat"])),mounted:function(){var e=this;this.$nextTick((function(){e.lesson.id&&e.initPlayer()}))},watch:{"lesson.id":function(e,t){this.initPlayer()}},beforeDestroy:function(){this.player&&this.player.dispose()}},q=w,T=s("2877"),I=s("007d"),x=s("eebe"),P=s.n(x),$=Object(T["a"])(q,f,g,!1,null,null,null),L=$.exports;P()($,"components",{QSpinnerTail:I["a"]});var k=s("e6b0");d["a"].registerPlugin(u["a"],p["a"],h["a"],m["a"]);var D={name:"Lesson",components:{VideoPlayerAi:L,Chat:k["a"]},data:function(){return{chatHeight:0,lesson:null}},methods:l()(l()({},Object(c["b"])(["sendLessonProgress","getLessonDetail","getListLessons","getNextStage"])),{},{resizePage:function(e){var t;t=this.$q.screen.width<1024?window.innerHeight-150:window.innerHeight-this.$refs.chat_teacher?this.$refs.chat_teacher.getBoundingClientRect().top-60:window.innerHeight-280,this.chatHeight=t},getLessonD:function(e){var t=this,s=this.getLessonDetail({id:e}),a=this.getNextStage({});Promise.all([s,a]).then((function(e){t.lesson=e[0].data,t.$nextTick((function(){t.resizePage()})),t.getListLessons({})}))},initDataPage:function(){var e=this;this.currContactID=this.teacherContact?this.teacherContact.id:null,this.getLessonD(this.lesson_id),window.onblur=function(){"lesson"==e.$route.name&&e.$refs.vp.player.pause()}}}),computed:{lesson_id:function(){return parseInt(this.$route.params.id)},nextLesson:function(){var e=_.findIndex(this.listLessons,{id:this.lesson_id});return this.listLessons[-1!=e?e+1:0]}},watch:{$route:function(e){this.initDataPage()},userInfo:function(){this.initDataPage()}},mounted:function(){this.userInfo&&this.initDataPage()}},S=D,O=s("9989"),z=s("05c0"),Q=s("9c40"),H=s("0016"),N=s("f09f"),j=s("a370"),R=s("eb85"),F=s("3980"),B=Object(T["a"])(S,i,r,!1,null,null,null),E=B.exports;P()(B,"components",{QPage:O["a"],QTooltip:z["a"],QBtn:Q["a"],QIcon:H["a"],QCard:N["a"],QCardSection:j["a"],QSeparator:R["a"],QResizeObserver:F["a"]});var V=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",[s("page-loader",{attrs:{state:e.pageIsLoad}}),e.lesson?s("q-card",{staticClass:"lessons transparent",staticStyle:{"border-radius":"0 !important"},attrs:{flat:""}},[s("q-card-section",{staticClass:"lesson-top relative-position full-width"},[s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col-auto"},[s("q-btn",{staticClass:"q-pr-md",attrs:{dense:"",round:"",flat:"",to:"/lessons"}},[s("q-icon",{staticStyle:{transform:"rotate(180deg)"},attrs:{name:"img:icons/schedule.svg",size:"20px"}})],1)],1),s("div",{staticClass:"col"},[s("div",{staticClass:"row items-center"},[s("div",{staticClass:"col"},[s("div",{staticClass:"lesson-head"},[e._v("Урок "+e._s(e.lesson.number))])])]),s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col text-left"},[s("div",{staticClass:"lesson-subtitle"},[e._v(e._s(e.lesson.title))])])])])])]),s("q-card-section",{staticClass:"q-pa-none",staticStyle:{"min-height":"200px"}},[s("video-player-ai",{ref:"vp",attrs:{lesson:e.lesson},on:{getLessonD:e.getLessonD}})],1),e.lesson.train_allowed?s("q-card-section",{staticClass:"q-pt-none q-pl-sm q-pr-sm q-pb-sm q-mt-sm"},[s("q-btn",{staticClass:"btn-orange-mobile",staticStyle:{width:"100%"},attrs:{flat:"","no-caps":"",to:"/training/"+e.lesson.id}},[s("q-icon",{attrs:{name:"img:icons/Button_Training.svg",size:"20px"}}),s("span",{staticClass:"btn-title"},[e._v("Пройти тренировку")])],1)],1):e._e(),e.teacherContact?s("q-card-section",{staticClass:"q-pa-none font-sspro-sr q-pa-none bg-white",class:{"open-chat-full":e.chatIsFullHeight}},[s("div",{staticClass:"row items-center q-pa-sm",staticStyle:{"border-bottom":"solid 1px #DDDFEB"}},[s("div",{staticClass:"user-avatar"},[s("img",{attrs:{src:e.teacherContact&&e.teacherContact.avatar?e.origin+"/"+e.teacherContact.avatar:e.avatar_null,alt:""}})]),s("div",{staticClass:"user-username"},[e._v("\n\n            "+e._s(e.teacherContact?e.teacherContact.full_name:"---")+"\n  \n          ")]),s("div",{staticClass:"user-status"},[s("span",{staticClass:"online"},[s("span",{staticClass:"bg"})]),s("p",{staticClass:"text"},[e._v("На связи")])]),s("q-space"),s("div",{staticClass:"col-auto"},[s("q-btn",{style:{transform:"rotate("+(e.chatIsFullHeight?"0":"180")+"deg)"},attrs:{round:"",flat:"",icon:"img:icons/Arrow_Dropdown_R.svg",size:"10px"},on:{click:function(t){e.chatIsFullHeight=!e.chatIsFullHeight}}})],1)],1),s("chat",{ref:"chat_teacher",attrs:{mobile:!0,height:e.chatHeight,color_input:"#f0f1f7"},on:{focusIn:e.focusIn}})],1):e._e()],1):e._e(),s("q-resize-observer",{on:{resize:e.resizePage}})],1)},M=[],A=s("9f3a");d["a"].registerPlugin(u["a"],p["a"],h["a"],m["a"]);var J={name:"Lesson",components:{VideoPlayerAi:L,Chat:k["a"],PageLoader:A["a"]},data:function(){return{pageIsLoad:!1,chatIsFullHeight:!1,chatHeight:150,lesson:null}},methods:l()(l()({},Object(c["b"])(["sendLessonProgress","getListLessons","getLessonDetail","getNextStage"])),{},{focusIn:function(){this.chatIsFullHeight=!0},resizePage:function(){if(void 0!=this.$refs.chat_teacher){var e=75;this.chatIsFullHeight&&!this.showNavMobile&&(e=0),this.chatHeight=window.innerHeight-this.$refs.chat_teacher.$el.getBoundingClientRect().top-e}},getLessonD:function(e){var t=this,s=this.getLessonDetail({id:e}),a=this.getNextStage({});this.pageIsLoad=!0,Promise.all([s,a]).then((function(e){t.lesson=e[0].data,t.pageIsLoad=!1,t.$nextTick((function(){t.resizePage()}))}))},initDataPage:function(){var e=this;this.currContactID=this.teacherContact?this.teacherContact.id:null,this.getLessonD(this.lesson_id),window.onblur=function(){"lesson"==e.$route.name&&void 0!=e.$refs.vp&&e.$refs.vp.player.pause()}}}),computed:l()(l()({},Object(c["c"])(["showNavMobile"])),{},{lesson_id:function(){return parseInt(this.$route.params.id)},nextLesson:function(){var e=_.findIndex(this.listLessons,{id:this.lesson_id});return this.listLessons[-1!=e?e+1:0]}}),watch:{$route:function(e){this.initDataPage()},chatIsFullHeight:function(e){var t=this;this.$nextTick((function(){t.resizePage(),e&&void 0!=t.$refs.vp?t.$refs.vp.player.pause():t.$refs.vp.player.play()}))},userInfo:function(){this.initDataPage()},showNavMobile:function(){var e=this;this.$nextTick((function(){e.resizePage()}))}},mounted:function(){this.userInfo&&this.initDataPage()}},U=J,G=s("2c91"),K=Object(T["a"])(U,V,M,!1,null,null,null),W=K.exports;P()(K,"components",{QPage:O["a"],QCard:N["a"],QCardSection:j["a"],QBtn:Q["a"],QIcon:H["a"],QSpace:G["a"],QResizeObserver:F["a"]});var X={name:"Lesson",components:{LessonDesktop:E,LessonMobile:W},data:function(){return{isview:!1}},methods:{change:function(e){this.$refs.lesson.$refs.vp.isview(e)}}},Y=X,Z=s("4e73"),ee=s("7f67"),te=Object(T["a"])(Y,a,n,!1,null,null,null);t["default"]=te.exports;P()(te,"components",{QPage:O["a"],QBtn:Q["a"],QMenu:Z["a"],QCard:N["a"],QCardSection:j["a"]}),P()(te,"directives",{ClosePopup:ee["a"]})},1:function(e,t){}}]);